<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Totem</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
  <style>
    :root {
      --action-border-color: #005a9e;
      --background-light: #f5f5f5;
      --text-light: #333;
      --background-dark: #1a1a1a;
      --text-dark: #f0f0f0;
      --ribbon-gradient: linear-gradient(45deg, #0078d7, #005a9e);
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--background-light);
      color: var(--text-light);
      transition: background 0.3s, color 0.3s;
    }

    .dark-mode {
      background-color: var(--background-dark);
      color: var(--text-dark);
    }

    .ribbon {
      display: flex;
      justify-content: center;
      background: var(--ribbon-gradient);
      padding: 12px 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: relative;
      gap: 15px;
    }

    .tab-button {
      background: transparent;
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
    }

    .tab-button:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-1px);
    }

    .tab-button.active {
      background: rgba(255, 255, 255, 0.25);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .toggle-mode {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      transition: opacity 0.3s;
      padding: 8px;
      border-radius: 50%;
    }

    .toggle-mode:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .container {
      padding: 20px;
      margin-top: 20px;
    }

    .section {
      display: none;
      max-width: 600px;
      margin: 0 auto;
    }

    .section.active {
      display: block;
    }

    .input-group {
      margin-bottom: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    label {
      flex: 0 0 100px;
      font-weight: bold;
      margin: 8px 0;
    }

@media (max-width: 600px) {
  .input-group {
    flex-direction: column;
    align-items: flex-start;
  }

  .input-group label {
    flex: unset;
    margin-bottom: 4px;
  }
}

    input,
    textarea,
    select {
      flex: 1;
      min-width: 200px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
      transition: all 0.3s;
    }

    .dark-mode input,
    .dark-mode textarea,
    .dark-mode select {
      background: #333;
      border-color: #555;
      color: #fff;
    }

    .button-group {
      display: flex;
      gap: 5px;
      margin-left: auto;
    }

    .button-group button {
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #0078d7;
      color: white;
      transition: background 0.3s;
    }

    .button-group button:hover {
      background: #005a9e;
    }

    .action-button {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--action-border-color);
      border-radius: 8px;
      background: white;
      color: black;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .dark-mode .action-button {
      background: #2d2d2d;
      color: white;
    }

    /* Toast Notification Styles */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--background-dark);
      color: var(--text-dark);
      padding: 12px 24px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .toast.visible {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .toast.error {
      background: #d32f2f;
      color: white;
    }

    .toast.success {
      background: #388e3c;
      color: white;
    }

    @media (max-width: 600px) {
      .ribbon {
        padding: 10px 15px;
        gap: 8px;
      }
      
      .tab-button span {
        display: none;
      }
      
      .tab-button {
        padding: 8px;
      }

      input,
      textarea,
      select {
        width: 100%;
        min-width: unset;
      }

      .input-group {
        flex-direction: column;
      }
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    input:focus,
    button:focus,
    textarea:focus,
    select:focus {
      outline: 2px solid var(--action-border-color);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div class="ribbon">
    <button class="tab-button active" data-tab="masking" title="Masking Data">
      <i class="fas fa-user-secret"></i><span class="tab-label">Masking</span>
    </button>
    <button class="tab-button" data-tab="noteMaker" title="Note Maker">
      <i class="fas fa-sticky-note"></i><span class="tab-label">Note Maker</span>
    </button>
    <button class="tab-button" data-tab="lowerCase" title="Lower Case">
      <i class="fas fa-font"></i><span class="tab-label">Lower Case</span>
    </button>
    <button class="toggle-mode" id="modeToggle" title="Toggle Dark/Light Mode">
      <i class="fas fa-moon"></i>
      <span class="sr-only">Toggle Dark Mode</span>
    </button>
  </div>

  <div class="container">
    <!-- Sections remain the same as original -->
    <div class="section active" id="masking">
      <h2>Masking Data</h2>
      <div class="input-group">
        <input type="text" id="maskInput" placeholder="Enter name or email to mask" aria-label="Text to mask" />
        <div class="button-group">
          <button id="pasteMask" title="Paste"><i class="fas fa-paste"></i></button>
          <button id="clearMask" title="Clear"><i class="fas fa-trash-alt"></i></button>
        </div>
      </div>
      <div class="input-group">
        <input type="text" id="maskResult" placeholder="Masked result" readonly aria-label="Masked result" />
        <div class="button-group">
          <button id="copyMask" title="Copy"><i class="fas fa-copy"></i></button>
        </div>
      </div>
      <button id="maskDataBtn" class="action-button">Mask Data</button>
    </div>

    <div class="section" id="noteMaker">
      <h2>Note Maker</h2>
      <div class="input-group">
        <label for="uid">UID:</label>
        <input type="text" id="uid" placeholder="Enter UID" />
      </div>
      <div class="input-group">
        <label for="issue">Issue:</label>
        <input type="text" id="issue" placeholder="Enter Issue" />
      </div>
      <div class="input-group">
        <label for="action">Action Taken:</label>
        <input type="text" id="action" placeholder="Enter Action Taken" />
      </div>
      <div class="input-group">
        <label for="nextStep">Next Step:</label>
        <input type="text" id="nextStep" value="Based on user response" />
      </div>
      <div class="input-group">
        <label for="serviceRecord">Service Record:</label>
        <select id="serviceRecord">
          <option value="no">No service record</option>
          <option value="available">Service record available</option>
          <option value="old record">Old service record available</option>
        </select>
      </div>
      <div class="input-group">
        <textarea id="noteResult" placeholder="Generated note will appear here" rows="4" readonly></textarea>
      </div>
      <div class="input-group">
        <div class="button-group">
          <button id="copyNote" title="Copy"><i class="fas fa-copy"></i></button>
          <button id="clearNote" title="Clear"><i class="fas fa-trash-alt"></i></button>
        </div>
        <button id="generateNoteBtn" class="action-button">Generate Note</button>
      </div>
    </div>

    <div class="section" id="lowerCase">
      <h2>Lower Case</h2>
      <div class="input-group">
        <input type="text" id="lowerInput" placeholder="Enter text to convert to lower case" aria-label="Text to convert to lowercase" />
        <div class="button-group">
          <button id="pasteLower" title="Paste"><i class="fas fa-paste"></i></button>
        </div>
      </div>
      <div class="input-group">
        <input type="text" id="lowerResult" placeholder="Converted text" readonly aria-label="Lowercase result" />
        <div class="button-group">
          <button id="copyLower" title="Copy"><i class="fas fa-copy"></i></button>
        </div>
      </div>
      <button id="convertLowerBtn" class="action-button">Convert to Lower Case</button>
    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite"></div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Toast notification system
      function showToast(message, type = 'info', duration = 3000) {
        const toast = document.getElementById('toast');
        toast.className = `toast ${type} visible`;
        toast.textContent = message;
        
        setTimeout(() => {
          toast.classList.remove('visible');
        }, duration);
      }

      // Dark mode persistence
      const isDarkMode = localStorage.getItem('darkMode') === 'true';
      if (isDarkMode) {
        document.body.classList.add('dark-mode');
        document.querySelector('#modeToggle i').classList.replace('fa-moon', 'fa-sun');
      }

      // Disable autocomplete
      document.querySelectorAll('input, select, textarea').forEach(el => {
        el.setAttribute('autocomplete', 'off');
      });

      // Clipboard functions
      async function handlePaste(targetElement) {
        try {
          const text = await navigator.clipboard.readText();
          targetElement.value = text;
        } catch (err) {
          showToast("Failed to read clipboard", "error");
        }
      }

      async function handleCopy(text) {
        try {
          await navigator.clipboard.writeText(text);
          showToast("Copied to clipboard", "success");
        } catch (err) {
          showToast("Failed to copy text", "error");
        }
      }

      // Masking function
      function maskText(text) {
        if (!text.trim()) return '';
        
        const getSegments = (str) => {
          if (typeof Intl.Segmenter === 'function') {
            const segmenter = new Intl.Segmenter('en', { granularity: 'grapheme' });
            return Array.from(segmenter.segment(str), s => s.segment);
          }
          return Array.from(str);
        };

        const segments = getSegments(text);
        const atCount = segments.filter(c => c === '@').length;
        
        if (atCount > 1) return segments.map(c => c === '@' ? c : '*').join('');
        
        if (text.includes('@')) {
          const [local, domain] = text.split('@');
          const localSegments = getSegments(local);
          return localSegments.length < 2 
            ? `${local}***@${domain}`
            : `${localSegments[0]}***${localSegments.slice(-1)}@${domain}`;
        }
        
        return segments.join('').split(' ').map(word => {
          const wordSegments = getSegments(word);
          if (wordSegments.length < 3) return `${wordSegments[0]}***`;
          return `${wordSegments[0]}***${wordSegments.slice(-1)}`;
        }).join(' ');
      }

      // Event Listeners
      document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
          document.querySelectorAll('.tab-button, .section').forEach(el => el.classList.remove('active'));
          button.classList.add('active');
          document.getElementById(button.dataset.tab).classList.add('active');
        });
      });

      document.getElementById('modeToggle').addEventListener('click', () => {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', isDark);
        const icon = document.querySelector('#modeToggle i');
        icon.classList.toggle('fa-moon');
        icon.classList.toggle('fa-sun');
      });

      // Masking Section
      document.getElementById('pasteMask').addEventListener('click', () => 
        handlePaste(document.getElementById('maskInput')));
      
      document.getElementById('copyMask').addEventListener('click', () => 
        handleCopy(document.getElementById('maskResult').value));
      
      document.getElementById('clearMask').addEventListener('click', () => {
        document.getElementById('maskInput').value = '';
        document.getElementById('maskResult').value = '';
      });

      document.getElementById('maskDataBtn').addEventListener('click', function() {
        const input = document.getElementById('maskInput');
        if (!input.value.trim()) {
          showToast("Please enter text to mask", "error");
          return;
        }
        document.getElementById('maskResult').value = maskText(input.value.trim());
      });

      // Note Maker Section
      document.getElementById('generateNoteBtn').addEventListener('click', function() {
        const fields = {
          uid: document.getElementById('uid').value.trim(),
          issue: document.getElementById('issue').value.trim(),
          action: document.getElementById('action').value.trim(),
          nextStep: document.getElementById('nextStep').value.trim(),
          serviceRecord: document.getElementById('serviceRecord').value
        };

        const parts = [];
        if (fields.uid) parts.push(`UID: ${fields.uid}`);
        if (fields.issue) parts.push(`issue: ${fields.issue}`);
        if (fields.action) parts.push(`action taken: ${fields.action}`);
        if (fields.nextStep) parts.push(`next step: ${fields.nextStep}`);
        if (fields.serviceRecord) parts.push(`service record: ${fields.serviceRecord}`);

        document.getElementById('noteResult').value = parts.join(' // ') || 'Please fill in at least one field';
      });

      document.getElementById('copyNote').addEventListener('click', () => 
        handleCopy(document.getElementById('noteResult').value));
      
      document.getElementById('clearNote').addEventListener('click', () => {
        document.getElementById('uid').value = '';
        document.getElementById('issue').value = '';
        document.getElementById('action').value = '';
        document.getElementById('nextStep').value = 'Based on user response';
        document.getElementById('serviceRecord').selectedIndex = 0;
        document.getElementById('noteResult').value = '';
      });

      // Lower Case Section
      document.getElementById('convertLowerBtn').addEventListener('click', function() {
        const input = document.getElementById('lowerInput');
        if (!input.value.trim()) {
          showToast("Please enter text to convert", "error");
          return;
        }
        document.getElementById('lowerResult').value = input.value.toLowerCase();
      });

      document.getElementById('pasteLower').addEventListener('click', () => 
        handlePaste(document.getElementById('lowerInput')));
      
      document.getElementById('copyLower').addEventListener('click', () => 
        handleCopy(document.getElementById('lowerResult').value));

      // Enter Key Handling
      document.querySelectorAll('input, textarea').forEach(element => {
        element.addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            e.preventDefault();
            const section = element.closest('.section');
            if (section.id === 'masking') document.getElementById('maskDataBtn').click();
            if (section.id === 'noteMaker') document.getElementById('generateNoteBtn').click();
            if (section.id === 'lowerCase') document.getElementById('convertLowerBtn').click();
          }
        });
      });
    });
  </script>
</body>
</html>
